2019-02-21 15:58:55.903 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-21 15:58:56.466 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-21 15:58:56.466 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-21 15:58:56.466 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-21 15:58:56.466 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-21 15:58:56.466 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-21 15:58:56.466 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-21 15:58:56.744 -08:00 [DBG] Starting grant removal
2019-02-21 15:58:57.112 -08:00 [DBG] Login Url: /Account/Login
2019-02-21 15:58:57.114 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-21 15:58:57.114 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-21 15:58:57.114 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-21 15:58:57.114 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-21 15:58:57.114 -08:00 [DBG] Error Url: /home/error
2019-02-21 15:58:57.114 -08:00 [DBG] Error Id Parameter: errorId
2019-02-21 15:58:57.158 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 15:58:57.167 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:04:15.239 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-21 16:04:15.385 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-21 16:04:15.385 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-21 16:04:15.385 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-21 16:04:15.385 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-21 16:04:15.385 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-21 16:04:15.385 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-21 16:04:15.528 -08:00 [DBG] Starting grant removal
2019-02-21 16:04:15.862 -08:00 [DBG] Login Url: /Account/Login
2019-02-21 16:04:15.864 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-21 16:04:15.864 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-21 16:04:15.864 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-21 16:04:15.864 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-21 16:04:15.864 -08:00 [DBG] Error Url: /home/error
2019-02-21 16:04:15.864 -08:00 [DBG] Error Id Parameter: errorId
2019-02-21 16:04:15.872 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:04:15.882 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:12:22.335 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-21 16:12:22.785 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-21 16:12:22.789 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-21 16:12:22.791 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-21 16:12:22.817 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-21 16:12:22.817 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-21 16:12:22.821 -08:00 [DBG] Start discovery request
2019-02-21 16:12:23.418 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-21 16:12:23.494 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-21 16:12:23.496 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-21 16:12:23.497 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-21 16:12:23.500 -08:00 [DBG] Start authorize request
2019-02-21 16:12:23.507 -08:00 [DBG] No user present in authorize request
2019-02-21 16:12:23.518 -08:00 [DBG] Start authorize request protocol validation
2019-02-21 16:12:23.942 -08:00 [DBG] holSpa found in database: true
2019-02-21 16:12:23.948 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-21 16:12:24.038 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:12:24.090 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:12:24.145 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:12:24.162 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:12:24.168 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-21 16:12:24.178 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"4a86ecc02efe421dab7c05e3ac90edfc","UiLocales":null,"Nonce":"7177fe2db9474cfa9ec0f35afa1080a3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"4a86ecc02efe421dab7c05e3ac90edfc","nonce":"7177fe2db9474cfa9ec0f35afa1080a3"},"$type":"AuthorizeRequestValidationLog"}
2019-02-21 16:12:24.189 -08:00 [INF] Showing login: User is not authenticated
2019-02-21 16:12:24.266 -08:00 [DBG] Start authorize request protocol validation
2019-02-21 16:12:24.531 -08:00 [DBG] holSpa found in database: true
2019-02-21 16:12:24.531 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-21 16:12:24.606 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:12:24.631 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:12:24.713 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:12:24.736 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:12:24.736 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-21 16:12:24.965 -08:00 [DBG] holSpa found in database: true
2019-02-21 16:12:24.965 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-21 16:12:33.051 -08:00 [INF] AuthenticationScheme: idsrv.external signed in.
2019-02-21 16:12:33.147 -08:00 [ERR] An unhandled exception has occurred while executing the request.
System.Exception: External authentication error
   at Host.Quickstart.Account.ExternalController.Callback() in S:\IdentityServer\src\IdentityServer\Quickstart\Account\ExternalController.cs:line 96
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Builder.RouterMiddleware.Invoke(HttpContext httpContext)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events) in C:\local\identity\server4\IdentityServer4\src\Hosting\IdentityServerMiddleware.cs:line 72
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.Invoke(HttpContext context)
   at IdentityServer4.Hosting.BaseUrlMiddleware.Invoke(HttpContext context) in C:\local\identity\server4\IdentityServer4\src\Hosting\BaseUrlMiddleware.cs:line 36
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-02-21 16:26:35.091 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-21 16:26:35.164 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-21 16:26:35.164 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-21 16:26:35.164 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-21 16:26:35.165 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-21 16:26:35.171 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-21 16:26:35.171 -08:00 [DBG] Start discovery request
2019-02-21 16:26:35.454 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-21 16:26:35.711 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:26:35.711 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:26:35.712 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-21 16:26:35.712 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-21 16:26:35.712 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-21 16:26:35.712 -08:00 [DBG] Start authorize request
2019-02-21 16:26:35.712 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:26:35.712 -08:00 [DBG] No user present in authorize request
2019-02-21 16:26:35.713 -08:00 [DBG] Start authorize request protocol validation
2019-02-21 16:26:35.961 -08:00 [DBG] holSpa found in database: true
2019-02-21 16:26:35.961 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-21 16:26:36.017 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:26:36.041 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:26:36.093 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:26:36.109 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:26:36.109 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-21 16:26:36.109 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"3b294d4822b84173a9da1e240f915e64","UiLocales":null,"Nonce":"424819d3be114310a85c3ecffcb7ef08","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"3b294d4822b84173a9da1e240f915e64","nonce":"424819d3be114310a85c3ecffcb7ef08"},"$type":"AuthorizeRequestValidationLog"}
2019-02-21 16:26:36.109 -08:00 [INF] Showing login: User is not authenticated
2019-02-21 16:26:36.122 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:26:36.122 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:26:36.138 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-21 16:26:36.138 -08:00 [DBG] Start authorize request protocol validation
2019-02-21 16:26:36.389 -08:00 [DBG] holSpa found in database: true
2019-02-21 16:26:36.390 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-21 16:26:36.464 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:26:36.489 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:26:36.557 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-21 16:26:36.597 -08:00 [DBG] Found [] API scopes in database
2019-02-21 16:26:36.598 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-21 16:26:37.814 -08:00 [DBG] holSpa found in database: true
2019-02-21 16:26:37.814 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:22:24.200 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-22 16:22:24.617 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-22 16:22:24.617 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-22 16:22:24.617 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-22 16:22:24.617 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-22 16:22:24.617 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-22 16:22:24.617 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-22 16:22:24.924 -08:00 [DBG] Starting grant removal
2019-02-22 16:22:25.290 -08:00 [DBG] Login Url: /Account/Login
2019-02-22 16:22:25.292 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-22 16:22:25.292 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-22 16:22:25.292 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-22 16:22:25.292 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-22 16:22:25.292 -08:00 [DBG] Error Url: /home/error
2019-02-22 16:22:25.292 -08:00 [DBG] Error Id Parameter: errorId
2019-02-22 16:22:25.302 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:22:25.314 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:23:16.084 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-22 16:23:16.743 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-22 16:23:16.747 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-22 16:23:16.749 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-22 16:23:16.798 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-22 16:23:16.798 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-22 16:23:16.801 -08:00 [DBG] Start discovery request
2019-02-22 16:23:17.518 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-22 16:23:17.584 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:23:17.584 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:23:17.584 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-22 16:23:17.587 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-22 16:23:17.587 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-22 16:23:17.591 -08:00 [DBG] Start authorize request
2019-02-22 16:23:17.602 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:23:17.606 -08:00 [DBG] No user present in authorize request
2019-02-22 16:23:17.661 -08:00 [DBG] Start authorize request protocol validation
2019-02-22 16:23:18.108 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:23:18.113 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:23:18.205 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:23:18.257 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:23:18.334 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:23:18.351 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:23:18.357 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-22 16:23:18.369 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"bce2de398f0944b7a1e20c7f1489c598","UiLocales":null,"Nonce":"b483a4629ccc4155affb1c8f482dd004","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"bce2de398f0944b7a1e20c7f1489c598","nonce":"b483a4629ccc4155affb1c8f482dd004"},"$type":"AuthorizeRequestValidationLog"}
2019-02-22 16:23:18.379 -08:00 [INF] Showing login: User is not authenticated
2019-02-22 16:23:18.395 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:23:18.395 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:23:18.454 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:23:18.454 -08:00 [DBG] Start authorize request protocol validation
2019-02-22 16:23:18.719 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:23:18.719 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:23:18.784 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:23:18.807 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:23:18.879 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:23:18.908 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:23:18.908 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-22 16:27:58.142 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:27:58.142 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:33:03.394 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-22 16:33:03.551 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-22 16:33:03.552 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-22 16:33:03.552 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-22 16:33:03.552 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-22 16:33:03.552 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-22 16:33:03.552 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-22 16:33:03.701 -08:00 [DBG] Starting grant removal
2019-02-22 16:33:03.935 -08:00 [DBG] Login Url: /Account/Login
2019-02-22 16:33:03.937 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-22 16:33:03.937 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-22 16:33:03.937 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-22 16:33:03.937 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-22 16:33:03.937 -08:00 [DBG] Error Url: /home/error
2019-02-22 16:33:03.937 -08:00 [DBG] Error Id Parameter: errorId
2019-02-22 16:33:03.946 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:03.956 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:15.526 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-22 16:33:15.957 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-22 16:33:15.961 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-22 16:33:15.963 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-22 16:33:15.979 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-22 16:33:15.980 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-22 16:33:15.982 -08:00 [DBG] Start discovery request
2019-02-22 16:33:16.579 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-22 16:33:16.623 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:16.624 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:16.624 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-22 16:33:16.627 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-22 16:33:16.627 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-22 16:33:16.630 -08:00 [DBG] Start authorize request
2019-02-22 16:33:16.633 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:16.637 -08:00 [DBG] No user present in authorize request
2019-02-22 16:33:16.648 -08:00 [DBG] Start authorize request protocol validation
2019-02-22 16:33:17.107 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:33:17.114 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:33:17.203 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:33:17.255 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:33:17.311 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:33:17.327 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:33:17.332 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-22 16:33:17.342 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"30ffd9f24b854854b896c28732246acb","UiLocales":null,"Nonce":"1eb67fc73d004f1f972f43704a1e817c","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"30ffd9f24b854854b896c28732246acb","nonce":"1eb67fc73d004f1f972f43704a1e817c"},"$type":"AuthorizeRequestValidationLog"}
2019-02-22 16:33:17.351 -08:00 [INF] Showing login: User is not authenticated
2019-02-22 16:33:17.360 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:17.360 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:17.415 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:33:17.415 -08:00 [DBG] Start authorize request protocol validation
2019-02-22 16:33:17.678 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:33:17.678 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:33:17.745 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:33:17.768 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:33:17.841 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:33:17.866 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:33:17.866 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-22 16:33:28.262 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:33:28.262 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:40:28.706 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-22 16:40:28.847 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-22 16:40:28.848 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-22 16:40:28.848 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-22 16:40:28.848 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-22 16:40:28.848 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-22 16:40:28.848 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-22 16:40:28.993 -08:00 [DBG] Starting grant removal
2019-02-22 16:40:29.180 -08:00 [DBG] Login Url: /Account/Login
2019-02-22 16:40:29.181 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-22 16:40:29.181 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-22 16:40:29.181 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-22 16:40:29.181 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-22 16:40:29.181 -08:00 [DBG] Error Url: /home/error
2019-02-22 16:40:29.181 -08:00 [DBG] Error Id Parameter: errorId
2019-02-22 16:40:29.189 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:40:29.201 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:41:37.491 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-22 16:41:37.887 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-22 16:41:37.890 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-22 16:41:37.892 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-22 16:41:37.903 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-22 16:41:37.903 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-22 16:41:37.905 -08:00 [DBG] Start discovery request
2019-02-22 16:41:38.494 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-22 16:41:38.541 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:41:38.541 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:41:38.541 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-22 16:41:38.546 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-22 16:41:38.546 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-22 16:41:38.555 -08:00 [DBG] Start authorize request
2019-02-22 16:41:38.561 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:41:38.565 -08:00 [DBG] No user present in authorize request
2019-02-22 16:41:38.576 -08:00 [DBG] Start authorize request protocol validation
2019-02-22 16:41:39.014 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:41:39.020 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:41:39.113 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:41:39.161 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:41:39.214 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:41:39.231 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:41:39.237 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-22 16:41:39.248 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"582b37308aea4a7a8c3a87e04672eb4b","UiLocales":null,"Nonce":"62a62bee65a64c2bbdb7a3bf1b175603","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"582b37308aea4a7a8c3a87e04672eb4b","nonce":"62a62bee65a64c2bbdb7a3bf1b175603"},"$type":"AuthorizeRequestValidationLog"}
2019-02-22 16:41:39.258 -08:00 [INF] Showing login: User is not authenticated
2019-02-22 16:41:39.267 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:41:39.267 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:41:39.326 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:41:39.326 -08:00 [DBG] Start authorize request protocol validation
2019-02-22 16:41:39.580 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:41:39.580 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:41:39.664 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:41:39.688 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:41:39.760 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-22 16:41:39.783 -08:00 [DBG] Found [] API scopes in database
2019-02-22 16:41:39.783 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-22 16:41:52.753 -08:00 [DBG] holSpa found in database: true
2019-02-22 16:41:52.753 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-22 16:43:44.089 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:43:44.089 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:46:07.061 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:46:07.061 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:46:31.253 -08:00 [INF] AuthenticationScheme: idsrv.external signed in.
2019-02-22 16:46:37.430 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:46:37.430 -08:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2019-02-22 16:46:37.513 -08:00 [ERR] An unhandled exception has occurred while executing the request.
System.Exception: External authentication error
   at Host.Quickstart.Account.ExternalController.Callback() in S:\IdentityServer\src\IdentityServer\Quickstart\Account\ExternalController.cs:line 96
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Builder.RouterMiddleware.Invoke(HttpContext httpContext)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events) in C:\local\identity\server4\IdentityServer4\src\Hosting\IdentityServerMiddleware.cs:line 72
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.Invoke(HttpContext context)
   at IdentityServer4.Hosting.BaseUrlMiddleware.Invoke(HttpContext context) in C:\local\identity\server4\IdentityServer4\src\Hosting\BaseUrlMiddleware.cs:line 36
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-02-23 06:37:18.297 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-23 06:37:18.673 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-23 06:37:18.673 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-23 06:37:18.673 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-23 06:37:18.673 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-23 06:37:18.673 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-23 06:37:18.673 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-23 06:37:18.963 -08:00 [DBG] Starting grant removal
2019-02-23 06:37:23.668 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-23 06:37:23.751 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-23 06:37:23.751 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-23 06:37:23.751 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-23 06:37:23.751 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-23 06:37:23.751 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-23 06:37:23.751 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-23 06:37:23.815 -08:00 [DBG] Starting grant removal
2019-02-23 06:37:24.066 -08:00 [DBG] Login Url: /Account/Login
2019-02-23 06:37:24.067 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-23 06:37:24.067 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-23 06:37:24.067 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-23 06:37:24.067 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-23 06:37:24.067 -08:00 [DBG] Error Url: /home/error
2019-02-23 06:37:24.067 -08:00 [DBG] Error Id Parameter: errorId
2019-02-23 07:36:05.136 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-23 07:36:05.281 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-23 07:36:05.281 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-23 07:36:05.281 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-23 07:36:05.281 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-23 07:36:05.281 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-23 07:36:05.281 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-23 07:36:05.438 -08:00 [DBG] Starting grant removal
2019-02-23 07:36:05.697 -08:00 [DBG] Login Url: /Account/Login
2019-02-23 07:36:05.698 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-23 07:36:05.698 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-23 07:36:05.698 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-23 07:36:05.698 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-23 07:36:05.698 -08:00 [DBG] Error Url: /home/error
2019-02-23 07:36:05.699 -08:00 [DBG] Error Id Parameter: errorId
2019-02-23 07:37:39.460 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-23 07:37:39.596 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-23 07:37:39.596 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-23 07:37:39.596 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-23 07:37:39.596 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-23 07:37:39.597 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-23 07:37:39.597 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-23 07:37:39.738 -08:00 [DBG] Starting grant removal
2019-02-23 07:37:39.928 -08:00 [DBG] Login Url: /Account/Login
2019-02-23 07:37:39.930 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-23 07:37:39.930 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-23 07:37:39.930 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-23 07:37:39.930 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-23 07:37:39.930 -08:00 [DBG] Error Url: /home/error
2019-02-23 07:37:39.930 -08:00 [DBG] Error Id Parameter: errorId
2019-02-23 07:51:19.417 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 07:51:19.838 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 07:51:19.842 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 07:51:19.851 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 07:51:19.891 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 07:51:19.892 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 07:51:19.894 -08:00 [DBG] Start discovery request
2019-02-23 07:51:20.502 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 07:51:20.579 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-23 07:51:20.582 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-23 07:51:20.582 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-23 07:51:20.585 -08:00 [DBG] Start authorize request
2019-02-23 07:51:20.592 -08:00 [DBG] No user present in authorize request
2019-02-23 07:51:20.612 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 07:51:21.050 -08:00 [DBG] holSpa found in database: true
2019-02-23 07:51:21.056 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 07:51:21.147 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 07:51:21.190 -08:00 [DBG] Found [] API scopes in database
2019-02-23 07:51:21.244 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 07:51:21.260 -08:00 [DBG] Found [] API scopes in database
2019-02-23 07:51:21.266 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 07:51:21.276 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"657e01d52def4b5d956d70b77084c42c","UiLocales":null,"Nonce":"2fea94cf17ba4c68ae8f265cb30b2f00","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"657e01d52def4b5d956d70b77084c42c","nonce":"2fea94cf17ba4c68ae8f265cb30b2f00"},"$type":"AuthorizeRequestValidationLog"}
2019-02-23 07:51:21.285 -08:00 [INF] Showing login: User is not authenticated
2019-02-23 07:51:34.011 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 07:51:34.273 -08:00 [DBG] holSpa found in database: true
2019-02-23 07:51:34.273 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 07:51:34.338 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 07:51:34.359 -08:00 [DBG] Found [] API scopes in database
2019-02-23 07:51:34.449 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 07:51:34.471 -08:00 [DBG] Found [] API scopes in database
2019-02-23 07:51:34.471 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 07:51:41.463 -08:00 [DBG] holSpa found in database: true
2019-02-23 07:51:41.463 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 07:58:00.387 -08:00 [INF] AuthenticationScheme: Identity.External signed in.
2019-02-23 08:04:47.630 -08:00 [INF] {"Username":null,"Provider":"Windows","ProviderUserId":"DEQ\\nquan","SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","DisplayName":"DEQ\\nquan","Endpoint":"UI","Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLKPKJC0QBAK:00000006","TimeStamp":"2019-02-23T16:04:47.0000000Z","ProcessId":27832,"LocalIpAddress":"127.0.0.1:13783","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-02-23 08:04:49.296 -08:00 [DBG] Augmenting SignInContext
2019-02-23 08:04:49.298 -08:00 [DBG] Adding amr claim with value: external
2019-02-23 08:04:49.302 -08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-02-23 08:04:50.156 -08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-02-23 08:05:06.494 -08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-02-23 08:05:14.989 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-02-23 08:05:14.989 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-02-23 08:05:14.993 -08:00 [DBG] Start authorize callback request
2019-02-23 08:05:14.996 -08:00 [DBG] User in authorize request: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 08:05:14.996 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 08:05:15.277 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:05:15.277 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:05:15.327 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:05:15.347 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:05:15.446 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:05:15.479 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:05:15.479 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 08:05:15.480 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"657e01d52def4b5d956d70b77084c42c","UiLocales":null,"Nonce":"2fea94cf17ba4c68ae8f265cb30b2f00","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"6488c977947f6d452ce63ae4fd75e202","Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"657e01d52def4b5d956d70b77084c42c","nonce":"2fea94cf17ba4c68ae8f265cb30b2f00"},"$type":"AuthorizeRequestValidationLog"}
2019-02-23 08:05:23.789 -08:00 [DBG] Client is configured to not require consent, no consent is required
2019-02-23 08:05:23.794 -08:00 [DBG] Creating Implicit Flow response.
2019-02-23 08:05:23.803 -08:00 [DBG] Getting claims for access token for client: holSpa
2019-02-23 08:05:23.804 -08:00 [DBG] Getting claims for access token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 08:06:15.186 -08:00 [DBG] Getting claims for identity token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f and client: holSpa
2019-02-23 08:06:34.774 -08:00 [INF] {"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","Scopes":"openid profile","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****05sA","$type":"Token"},{"TokenType":"access_token","TokenValue":"****2QKQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLKPKJC0QBAK:00000007","TimeStamp":"2019-02-23T16:06:34.0000000Z","ProcessId":27832,"LocalIpAddress":"127.0.0.1:13783","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-02-23 08:06:34.776 -08:00 [INF] Authorize endpoint response
{"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ClientId":"holSpa","RedirectUri":"http://localhost:4200/auth-callback","State":"657e01d52def4b5d956d70b77084c42c","Scope":"openid profile","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-02-23 08:06:34.789 -08:00 [DBG] Augmenting SignInContext
2019-02-23 08:06:34.790 -08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-02-23 08:06:44.140 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 08:06:52.035 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:06:52.035 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:06:52.036 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 08:06:55.766 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 08:06:55.766 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 08:06:55.766 -08:00 [DBG] Start discovery request
2019-02-23 08:06:55.924 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 08:06:55.946 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2019-02-23 08:06:55.958 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:06:55.958 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:06:55.958 -08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-02-23 08:06:55.959 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-02-23 08:06:55.959 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-02-23 08:06:55.962 -08:00 [DBG] Start key discovery request
2019-02-23 08:06:56.012 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 08:06:56.026 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:06:56.026 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:06:56.032 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 08:06:56.044 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:06:56.044 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:06:56.044 -08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-02-23 08:06:56.046 -08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-02-23 08:06:56.046 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-02-23 08:06:56.052 -08:00 [DBG] Start userinfo request
2019-02-23 08:06:56.054 -08:00 [DBG] Bearer token found in header
2019-02-23 08:06:56.282 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:06:56.282 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:06:56.441 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:06:56.441 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:06:56.442 -08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-02-23 08:06:56.443 -08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1550937975,"exp":1551022575,"iss":"http://localhost:44317","aud":"http://localhost:44317/resources","client_id":"holSpa","sub":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","auth_time":1550937889,"idp":"Windows","name":"DEQ\\nquan","scope":["openid","profile"],"amr":"external"},"$type":"TokenValidationLog"}
2019-02-23 08:06:56.447 -08:00 [DBG] Creating userinfo response
2019-02-23 08:06:56.450 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 08:06:56.452 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 08:06:56.507 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:06:56.508 -08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2019-02-23 08:06:56.508 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 08:06:56.551 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:06:59.938 -08:00 [INF] Profile service returned the following claim types: name
2019-02-23 08:06:59.939 -08:00 [DBG] End userinfo request
2019-02-23 08:06:59.990 -08:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2019-02-23 08:06:59.991 -08:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2019-02-23 08:06:59.991 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2019-02-23 08:06:59.992 -08:00 [DBG] Rendering check session result
2019-02-23 08:22:44.736 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-23 08:22:44.894 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-23 08:22:44.895 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-23 08:22:44.895 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-23 08:22:44.895 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-23 08:22:44.895 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-23 08:22:44.895 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-23 08:22:45.057 -08:00 [DBG] Starting grant removal
2019-02-23 08:22:45.364 -08:00 [DBG] Login Url: /Account/Login
2019-02-23 08:22:45.366 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-23 08:22:45.366 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-23 08:22:45.366 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-23 08:22:45.367 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-23 08:22:45.367 -08:00 [DBG] Error Url: /home/error
2019-02-23 08:22:45.367 -08:00 [DBG] Error Id Parameter: errorId
2019-02-23 08:26:30.693 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 08:26:31.103 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:26:31.106 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:26:31.109 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 08:26:31.132 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 08:26:31.132 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 08:26:31.135 -08:00 [DBG] Start discovery request
2019-02-23 08:26:31.707 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 08:26:31.779 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-23 08:26:31.781 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-23 08:26:31.781 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-23 08:26:31.784 -08:00 [DBG] Start authorize request
2019-02-23 08:26:31.800 -08:00 [DBG] No user present in authorize request
2019-02-23 08:26:31.811 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 08:26:32.206 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:26:32.211 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:26:32.299 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:32.343 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:26:32.400 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:32.417 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:26:32.423 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 08:26:32.433 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"1444b949f5494d40ba1c64ccafb7f153","UiLocales":null,"Nonce":"f79a9d5bc71148f68a852fdda66b872a","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"1444b949f5494d40ba1c64ccafb7f153","nonce":"f79a9d5bc71148f68a852fdda66b872a"},"$type":"AuthorizeRequestValidationLog"}
2019-02-23 08:26:32.442 -08:00 [INF] Showing login: User is not authenticated
2019-02-23 08:26:32.523 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 08:26:32.766 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:26:32.766 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:26:32.834 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:32.855 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:26:32.920 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:32.942 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:26:32.943 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 08:26:33.165 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:26:33.165 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:26:33.385 -08:00 [INF] AuthenticationScheme: Identity.External signed in.
2019-02-23 08:26:33.731 -08:00 [INF] {"Username":null,"Provider":"Windows","ProviderUserId":"DEQ\\nquan","SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","DisplayName":"DEQ\\nquan","Endpoint":"UI","Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLKPLCI9KD1E:00000006","TimeStamp":"2019-02-23T16:26:33.0000000Z","ProcessId":10148,"LocalIpAddress":"127.0.0.1:28233","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-02-23 08:26:33.739 -08:00 [DBG] Augmenting SignInContext
2019-02-23 08:26:33.742 -08:00 [DBG] Adding amr claim with value: external
2019-02-23 08:26:33.746 -08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-02-23 08:26:33.750 -08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-02-23 08:26:33.776 -08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-02-23 08:26:33.777 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-02-23 08:26:33.777 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-02-23 08:26:33.781 -08:00 [DBG] Start authorize callback request
2019-02-23 08:26:33.784 -08:00 [DBG] User in authorize request: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 08:26:33.784 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 08:26:33.958 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:26:33.958 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:26:34.005 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:34.032 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:26:34.100 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:34.117 -08:00 [DBG] Found [] API scopes in database
2019-02-23 08:26:34.117 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 08:26:34.117 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"1444b949f5494d40ba1c64ccafb7f153","UiLocales":null,"Nonce":"f79a9d5bc71148f68a852fdda66b872a","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"4826e287e422257d962dafc24b7b5afc","Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"1444b949f5494d40ba1c64ccafb7f153","nonce":"f79a9d5bc71148f68a852fdda66b872a"},"$type":"AuthorizeRequestValidationLog"}
2019-02-23 08:26:34.125 -08:00 [DBG] Client is configured to not require consent, no consent is required
2019-02-23 08:26:34.130 -08:00 [DBG] Creating Implicit Flow response.
2019-02-23 08:26:34.139 -08:00 [DBG] Getting claims for access token for client: holSpa
2019-02-23 08:26:34.139 -08:00 [DBG] Getting claims for access token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 08:26:34.212 -08:00 [DBG] Getting claims for identity token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f and client: holSpa
2019-02-23 08:26:34.219 -08:00 [INF] {"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","Scopes":"openid profile","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****U32g","$type":"Token"},{"TokenType":"access_token","TokenValue":"****54NA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLKPLCI9KD1E:00000007","TimeStamp":"2019-02-23T16:26:34.0000000Z","ProcessId":10148,"LocalIpAddress":"127.0.0.1:28233","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-02-23 08:26:34.221 -08:00 [INF] Authorize endpoint response
{"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ClientId":"holSpa","RedirectUri":"http://localhost:4200/auth-callback","State":"1444b949f5494d40ba1c64ccafb7f153","Scope":"openid profile","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-02-23 08:26:34.236 -08:00 [DBG] Augmenting SignInContext
2019-02-23 08:26:34.236 -08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-02-23 08:26:42.497 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 08:26:42.551 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:26:42.551 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:26:42.552 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 08:26:42.553 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 08:26:42.553 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 08:26:42.553 -08:00 [DBG] Start discovery request
2019-02-23 08:26:42.863 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 08:26:47.211 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2019-02-23 08:26:47.255 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:26:47.255 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:26:47.255 -08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-02-23 08:26:47.256 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-02-23 08:26:47.256 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-02-23 08:26:47.259 -08:00 [DBG] Start key discovery request
2019-02-23 08:26:47.338 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 08:26:47.351 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:26:47.351 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:26:47.357 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 08:26:47.369 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 08:26:47.369 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 08:26:47.370 -08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-02-23 08:26:47.371 -08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-02-23 08:26:47.371 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-02-23 08:26:47.376 -08:00 [DBG] Start userinfo request
2019-02-23 08:26:47.379 -08:00 [DBG] Bearer token found in header
2019-02-23 08:26:47.588 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:26:47.588 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:26:47.740 -08:00 [DBG] holSpa found in database: true
2019-02-23 08:26:47.740 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 08:26:47.741 -08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-02-23 08:26:47.743 -08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1550939194,"exp":1551023794,"iss":"http://localhost:44317","aud":"http://localhost:44317/resources","client_id":"holSpa","sub":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","auth_time":1550939193,"idp":"Windows","name":"DEQ\\nquan","scope":["openid","profile"],"amr":"external"},"$type":"TokenValidationLog"}
2019-02-23 08:26:47.747 -08:00 [DBG] Creating userinfo response
2019-02-23 08:26:47.749 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 08:26:47.751 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 08:26:47.801 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:47.801 -08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2019-02-23 08:26:47.801 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 08:26:47.843 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 08:26:47.844 -08:00 [INF] Profile service returned the following claim types: name
2019-02-23 08:26:47.844 -08:00 [DBG] End userinfo request
2019-02-23 08:26:47.900 -08:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2019-02-23 08:26:47.900 -08:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2019-02-23 08:26:47.901 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2019-02-23 08:26:47.903 -08:00 [DBG] Rendering check session result
2019-02-23 16:51:13.049 -08:00 [INF] Starting IdentityServer4 version 2.3.2.0
2019-02-23 16:51:13.435 -08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-02-23 16:51:13.435 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-02-23 16:51:13.436 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-02-23 16:51:13.436 -08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-02-23 16:51:13.436 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-02-23 16:51:13.436 -08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-02-23 16:51:13.714 -08:00 [DBG] Starting grant removal
2019-02-23 16:51:13.982 -08:00 [DBG] Login Url: /Account/Login
2019-02-23 16:51:13.984 -08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-02-23 16:51:13.984 -08:00 [DBG] Logout Url: /Account/Logout
2019-02-23 16:51:13.984 -08:00 [DBG] ConsentUrl Url: /consent
2019-02-23 16:51:13.984 -08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-02-23 16:51:13.984 -08:00 [DBG] Error Url: /home/error
2019-02-23 16:51:13.984 -08:00 [DBG] Error Id Parameter: errorId
2019-02-23 16:54:49.369 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 16:54:50.030 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:54:50.034 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:54:50.036 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 16:54:50.072 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 16:54:50.072 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 16:54:50.075 -08:00 [DBG] Start discovery request
2019-02-23 16:54:50.720 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 16:54:50.790 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-23 16:54:50.792 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-23 16:54:50.793 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-23 16:54:50.796 -08:00 [DBG] Start authorize request
2019-02-23 16:54:50.802 -08:00 [DBG] No user present in authorize request
2019-02-23 16:54:50.856 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 16:54:51.280 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:54:51.285 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:54:51.377 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:54:51.423 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:54:51.479 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:54:51.495 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:54:51.501 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 16:54:51.512 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"d627e979e2534d8a9a17189bb95da16e","UiLocales":null,"Nonce":"36efe68eb9ab44a992467758f573f2a7","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"d627e979e2534d8a9a17189bb95da16e","nonce":"36efe68eb9ab44a992467758f573f2a7"},"$type":"AuthorizeRequestValidationLog"}
2019-02-23 16:54:51.522 -08:00 [INF] Showing login: User is not authenticated
2019-02-23 16:54:51.602 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 16:54:51.882 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:54:51.882 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:54:51.950 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:54:51.975 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:54:52.042 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:54:52.072 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:54:52.072 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 16:54:52.316 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:54:52.316 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:54:52.453 -08:00 [INF] AuthenticationScheme: Identity.External signed in.
2019-02-23 16:54:52.857 -08:00 [INF] {"Username":null,"Provider":"Windows","ProviderUserId":"DEQ\\nquan","SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","DisplayName":"DEQ\\nquan","Endpoint":"UI","Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLKPU8MHJGTL:00000006","TimeStamp":"2019-02-24T00:54:52.0000000Z","ProcessId":31972,"LocalIpAddress":"127.0.0.1:3877","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-02-23 16:54:52.865 -08:00 [DBG] Augmenting SignInContext
2019-02-23 16:54:52.867 -08:00 [DBG] Adding amr claim with value: external
2019-02-23 16:54:52.871 -08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-02-23 16:54:52.876 -08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-02-23 16:54:52.903 -08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-02-23 16:54:52.904 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-02-23 16:54:52.904 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-02-23 16:54:52.909 -08:00 [DBG] Start authorize callback request
2019-02-23 16:54:52.913 -08:00 [DBG] User in authorize request: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 16:54:52.913 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 16:54:53.087 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:54:53.087 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:54:53.133 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:54:53.148 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:54:53.200 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:54:53.219 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:54:53.220 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 16:54:53.220 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"d627e979e2534d8a9a17189bb95da16e","UiLocales":null,"Nonce":"36efe68eb9ab44a992467758f573f2a7","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"8cbfba1a357bf3822dd40d12d2971be5","Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"d627e979e2534d8a9a17189bb95da16e","nonce":"36efe68eb9ab44a992467758f573f2a7"},"$type":"AuthorizeRequestValidationLog"}
2019-02-23 16:54:53.228 -08:00 [DBG] Client is configured to not require consent, no consent is required
2019-02-23 16:54:53.233 -08:00 [DBG] Creating Implicit Flow response.
2019-02-23 16:54:53.241 -08:00 [DBG] Getting claims for access token for client: holSpa
2019-02-23 16:54:53.242 -08:00 [DBG] Getting claims for access token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 16:54:53.315 -08:00 [DBG] Getting claims for identity token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f and client: holSpa
2019-02-23 16:54:53.323 -08:00 [INF] {"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","Scopes":"openid profile","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****7cEQ","$type":"Token"},{"TokenType":"access_token","TokenValue":"****nxWw","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLKPU8MHJGTL:00000007","TimeStamp":"2019-02-24T00:54:53.0000000Z","ProcessId":31972,"LocalIpAddress":"127.0.0.1:3877","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-02-23 16:54:53.325 -08:00 [INF] Authorize endpoint response
{"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ClientId":"holSpa","RedirectUri":"http://localhost:4200/auth-callback","State":"d627e979e2534d8a9a17189bb95da16e","Scope":"openid profile","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-02-23 16:54:53.340 -08:00 [DBG] Augmenting SignInContext
2019-02-23 16:54:53.341 -08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-02-23 16:55:01.922 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 16:55:02.027 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:55:02.027 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:55:02.027 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 16:55:02.028 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 16:55:02.028 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 16:55:02.028 -08:00 [DBG] Start discovery request
2019-02-23 16:55:02.438 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 16:55:06.963 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2019-02-23 16:55:06.991 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:55:06.991 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:55:06.992 -08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-02-23 16:55:06.992 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-02-23 16:55:06.992 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-02-23 16:55:06.996 -08:00 [DBG] Start key discovery request
2019-02-23 16:55:07.088 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 16:55:07.101 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:55:07.101 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:55:07.106 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 16:55:07.118 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:55:07.118 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:55:07.118 -08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-02-23 16:55:07.120 -08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-02-23 16:55:07.120 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-02-23 16:55:07.125 -08:00 [DBG] Start userinfo request
2019-02-23 16:55:07.127 -08:00 [DBG] Bearer token found in header
2019-02-23 16:55:07.354 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:55:07.354 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:55:07.512 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:55:07.512 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:55:07.513 -08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-02-23 16:55:07.514 -08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1550969693,"exp":1551054293,"iss":"http://localhost:44317","aud":"http://localhost:44317/resources","client_id":"holSpa","sub":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","auth_time":1550969692,"idp":"Windows","name":"DEQ\\nquan","role":["DEQ\\Domain Users","Everyone","PDX102321-9SDI\\SophosAdministrator","PDX102321-9SDI\\SophosUser","BUILTIN\\Performance Log Users","BUILTIN\\Users","NT AUTHORITY\\INTERACTIVE","CONSOLE LOGON","NT AUTHORITY\\Authenticated Users","NT AUTHORITY\\This Organization","LOCAL","DEQ\\ZSQLGenericUser","DEQ\\WQ-DJ1050C","DEQ\\WAPA","DEQ\\ZSql HOTC View","DEQ\\WQ13","DEQ\\ER - Onsite - Read Only","DEQ\\ZSql Developers","DEQ\\ZSql WQ Developers","DEQ\\MSD - Bus Sys","DEQ\\LabDataBaseUsers","DEQ\\MSD - Users","DEQ\\SMS Report Group","DEQ\\QNET BSD APPLICATIONS","DEQ\\ZSql HOTC Entry","DEQ\\QNET Content Users CSD","DEQ\\HOTCGrantPermission","DEQ\\DEQSQLRUserGroup","DEQ\\DAS VPN Users","DEQ\\SQL2005DTSUsers","DEQ\\AllSQLDevelopers","DEQ\\ECSIAdmin","DEQ\\ECSIProjMgr","DEQ\\Changerequests","DEQ\\ZSQLAllDevelopers","DEQ\\LUSTDataStewards","DEQ\\CCDUsers","DEQ\\WQOnsiteGrantPermission","DEQ\\ORFSDataBrowser","DEQ\\Color Printer Mailroom","DEQ\\BSDSubversionUsers","DEQ\\LustAdmin","DEQ\\STAFFMSD","DEQ\\BSDDOGROUP","DEQ\\BSD-All","DEQ\\WebDocAdmin","DEQ\\WQUICGrantPermission","DEQ\\WQBioSolidsGrantPermission","DEQ\\DAS VPN RDP USERS","DEQ\\WQ303dGrantPermission","DEQ\\imstaff","DEQ\\GIS_Incoming","DEQ\\MSDBUSYSTM","Authentication authority asserted identity","DEQ\\BSD-ONESTOP","DEQ\\SophosUser"],"scope":["openid","profile"],"amr":"external"},"$type":"TokenValidationLog"}
2019-02-23 16:55:07.518 -08:00 [DBG] Creating userinfo response
2019-02-23 16:55:07.521 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 16:55:07.524 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 16:55:07.572 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:55:07.573 -08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2019-02-23 16:55:07.573 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 16:55:07.617 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:55:07.617 -08:00 [INF] Profile service returned the following claim types: name role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role
2019-02-23 16:55:07.618 -08:00 [DBG] End userinfo request
2019-02-23 16:55:07.664 -08:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2019-02-23 16:55:07.664 -08:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2019-02-23 16:55:07.664 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2019-02-23 16:55:07.665 -08:00 [DBG] Rendering check session result
2019-02-23 16:57:23.407 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 16:57:23.431 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:57:23.431 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:57:23.431 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 16:57:23.431 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 16:57:23.431 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 16:57:23.431 -08:00 [DBG] Start discovery request
2019-02-23 16:57:23.567 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 16:57:23.595 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 16:57:23.613 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:57:23.613 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:57:23.614 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 16:57:23.614 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 16:57:23.614 -08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-02-23 16:57:23.614 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 16:57:23.614 -08:00 [DBG] Start discovery request
2019-02-23 16:57:23.614 -08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-02-23 16:57:23.614 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-02-23 16:57:23.614 -08:00 [DBG] Start authorize request
2019-02-23 16:57:23.614 -08:00 [DBG] User in authorize request: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 16:57:23.614 -08:00 [DBG] Start authorize request protocol validation
2019-02-23 16:57:23.820 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 16:57:23.859 -08:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2019-02-23 16:57:23.859 -08:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2019-02-23 16:57:23.859 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2019-02-23 16:57:23.860 -08:00 [DBG] Rendering check session result
2019-02-23 16:57:23.960 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:57:23.960 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:57:24.023 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:57:24.047 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:57:24.104 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:57:24.122 -08:00 [DBG] Found [] API scopes in database
2019-02-23 16:57:24.122 -08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-02-23 16:57:24.122 -08:00 [INF] ValidatedAuthorizeRequest
{"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/assets/oidc-login-redirect.html","http://localhost:4200/auth-callback","http://localhost:4200/silent-refresh.html"],"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile","State":"698382486fbd473c84bfdc4481c655a8","UiLocales":null,"Nonce":"6844ba8c18664ed7ba9ae95dae86672f","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"8cbfba1a357bf3822dd40d12d2971be5","Raw":{"client_id":"holSpa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile","state":"698382486fbd473c84bfdc4481c655a8","nonce":"6844ba8c18664ed7ba9ae95dae86672f"},"$type":"AuthorizeRequestValidationLog"}
2019-02-23 16:57:24.122 -08:00 [DBG] Client is configured to not require consent, no consent is required
2019-02-23 16:57:24.123 -08:00 [DBG] Creating Implicit Flow response.
2019-02-23 16:57:24.123 -08:00 [DBG] Getting claims for access token for client: holSpa
2019-02-23 16:57:24.123 -08:00 [DBG] Getting claims for access token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f
2019-02-23 16:57:24.126 -08:00 [DBG] Getting claims for identity token for subject: 393ce808-66c9-453c-9500-7bc0c6e9fa4f and client: holSpa
2019-02-23 16:57:24.129 -08:00 [INF] {"ClientId":"holSpa","ClientName":"HOL Angular Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","Scopes":"openid profile","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****g09g","$type":"Token"},{"TokenType":"access_token","TokenValue":"****VxNA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLKPU8MHJGTN:00000001","TimeStamp":"2019-02-24T00:57:24.0000000Z","ProcessId":31972,"LocalIpAddress":"127.0.0.1:3877","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-02-23 16:57:24.129 -08:00 [INF] Authorize endpoint response
{"SubjectId":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","ClientId":"holSpa","RedirectUri":"http://localhost:4200/auth-callback","State":"698382486fbd473c84bfdc4481c655a8","Scope":"openid profile","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-02-23 16:57:27.753 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 16:57:27.780 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:57:27.780 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:57:27.781 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 16:57:27.781 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 16:57:27.781 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 16:57:27.781 -08:00 [DBG] Start discovery request
2019-02-23 16:57:28.117 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 16:57:28.172 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2019-02-23 16:57:28.200 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:57:28.200 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:57:28.200 -08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-02-23 16:57:28.200 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-02-23 16:57:28.200 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-02-23 16:57:28.200 -08:00 [DBG] Start discovery request
2019-02-23 16:57:28.448 -08:00 [DBG] Found ["openid","profile","holApi","ballastWaterApi"] as all scopes in database
2019-02-23 16:57:30.187 -08:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2019-02-23 16:57:30.215 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:57:30.215 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:57:30.216 -08:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2019-02-23 16:57:30.216 -08:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2019-02-23 16:57:30.216 -08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-02-23 16:57:30.216 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2019-02-23 16:57:30.216 -08:00 [DBG] Rendering check session result
2019-02-23 16:57:30.216 -08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-02-23 16:57:30.216 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-02-23 16:57:30.216 -08:00 [DBG] Start key discovery request
2019-02-23 16:57:30.304 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 16:57:30.383 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:57:30.383 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:57:30.388 -08:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2019-02-23 16:57:30.416 -08:00 [DBG] Origin http://localhost:4200 is allowed: true
2019-02-23 16:57:30.416 -08:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2019-02-23 16:57:30.416 -08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-02-23 16:57:30.416 -08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-02-23 16:57:30.416 -08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-02-23 16:57:30.416 -08:00 [DBG] Start userinfo request
2019-02-23 16:57:30.416 -08:00 [DBG] Bearer token found in header
2019-02-23 16:57:30.804 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:57:30.804 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:57:31.204 -08:00 [DBG] holSpa found in database: true
2019-02-23 16:57:31.204 -08:00 [DBG] client configuration validation for client holSpa succeeded.
2019-02-23 16:57:31.204 -08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-02-23 16:57:31.205 -08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1550969844,"exp":1551054444,"iss":"http://localhost:44317","aud":"http://localhost:44317/resources","client_id":"holSpa","sub":"393ce808-66c9-453c-9500-7bc0c6e9fa4f","auth_time":1550969692,"idp":"Windows","name":"DEQ\\nquan","role":["DEQ\\Domain Users","Everyone","PDX102321-9SDI\\SophosAdministrator","PDX102321-9SDI\\SophosUser","BUILTIN\\Performance Log Users","BUILTIN\\Users","NT AUTHORITY\\INTERACTIVE","CONSOLE LOGON","NT AUTHORITY\\Authenticated Users","NT AUTHORITY\\This Organization","LOCAL","DEQ\\ZSQLGenericUser","DEQ\\WQ-DJ1050C","DEQ\\WAPA","DEQ\\ZSql HOTC View","DEQ\\WQ13","DEQ\\ER - Onsite - Read Only","DEQ\\ZSql Developers","DEQ\\ZSql WQ Developers","DEQ\\MSD - Bus Sys","DEQ\\LabDataBaseUsers","DEQ\\MSD - Users","DEQ\\SMS Report Group","DEQ\\QNET BSD APPLICATIONS","DEQ\\ZSql HOTC Entry","DEQ\\QNET Content Users CSD","DEQ\\HOTCGrantPermission","DEQ\\DEQSQLRUserGroup","DEQ\\DAS VPN Users","DEQ\\SQL2005DTSUsers","DEQ\\AllSQLDevelopers","DEQ\\ECSIAdmin","DEQ\\ECSIProjMgr","DEQ\\Changerequests","DEQ\\ZSQLAllDevelopers","DEQ\\LUSTDataStewards","DEQ\\CCDUsers","DEQ\\WQOnsiteGrantPermission","DEQ\\ORFSDataBrowser","DEQ\\Color Printer Mailroom","DEQ\\BSDSubversionUsers","DEQ\\LustAdmin","DEQ\\STAFFMSD","DEQ\\BSDDOGROUP","DEQ\\BSD-All","DEQ\\WebDocAdmin","DEQ\\WQUICGrantPermission","DEQ\\WQBioSolidsGrantPermission","DEQ\\DAS VPN RDP USERS","DEQ\\WQ303dGrantPermission","DEQ\\imstaff","DEQ\\GIS_Incoming","DEQ\\MSDBUSYSTM","Authentication authority asserted identity","DEQ\\BSD-ONESTOP","DEQ\\SophosUser"],"scope":["openid","profile"],"amr":"external"},"$type":"TokenValidationLog"}
2019-02-23 16:57:31.205 -08:00 [DBG] Creating userinfo response
2019-02-23 16:57:31.205 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 16:57:31.205 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 16:57:31.250 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:57:31.250 -08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2019-02-23 16:57:31.250 -08:00 [DBG] Scopes in access token: openid profile
2019-02-23 16:57:31.297 -08:00 [DBG] Found ["openid","profile"] identity scopes in database
2019-02-23 16:57:31.297 -08:00 [INF] Profile service returned the following claim types: name role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role role
2019-02-23 16:57:31.297 -08:00 [DBG] End userinfo request
2019-02-23 17:51:13.739 -08:00 [INF] Removing 0 grants
